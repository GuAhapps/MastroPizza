<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="utf-t-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="theme-color" content="#F97316">
    <title>La Escapadita - Pergamino</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              'brand-bg': '#111827',
              'brand-header': '#231F20',
              'brand-card': '#1F2937',
              'brand-text': '#F3F4F6',
              'brand-text-light': '#9CA3AF',
              'brand-accent': '#F97316', // Orange-500
              'brand-teal': '#14B8A6', // Teal-500 for MastroPizza
            },
            fontWeight: {
              'extralight': 200,
            },
            animation: {
              'fade-in-up': 'fade-in-up 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94) both',
              'fade-in': 'fade-in 0.3s ease-out both',
            },
            keyframes: {
              'fade-in-up': {
                '0%': { 
                  opacity: '0', 
                  transform: 'translateY(20px) scale(0.95)' 
                },
                '100%': { 
                  opacity: '1', 
                  transform: 'translateY(0) scale(1)' 
                },
              },
              'fade-in': {
                '0%': { opacity: '0' },
                '100%': { opacity: '1' },
              }
            }
          }
        }
      }
    </script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@200;300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
      body {
        font-family: 'Montserrat', sans-serif;
        font-weight: 300;
        background-image: url('https://ia601009.us.archive.org/25/items/fondo-mesa-de-trabajo-1-mesa-de-trabajo-1/fondo_Mesa%20de%20trabajo%201_Mesa%20de%20trabajo%201.jpg');
        background-size: cover;
        background-position: center center;
        background-attachment: fixed;
      }
      .font-display {
        font-family: 'Montserrat', sans-serif;
      }
      /* Hide scrollbar for Chrome, Safari and Opera */
      .no-scrollbar::-webkit-scrollbar {
        display: none;
      }
      /* Hide scrollbar for IE, Edge and Firefox */
      .no-scrollbar {
        -ms-overflow-style: none;  /* IE and Edge */
        scrollbar-width: none;  /* Firefox */
      }
      .tabular-nums {
        font-variant-numeric: tabular-nums;
      }

      /* Unified mobile-first view with glassmorphism */
      .bg-brand-bg {
        background-color: transparent !important;
      }
      .bg-brand-header,
      .bg-brand-card {
        -webkit-backdrop-filter: blur(12px);
        backdrop-filter: blur(12px);
      }

      .bg-brand-header {
        background-color: rgba(35, 31, 32, 0.75) !important; /* #231F20 with opacity */
      }

      .bg-brand-card {
        background-color: rgba(31, 41, 55, 0.75) !important; /* #1F2937 with opacity */
      }

      .hover\\:bg-gray-700:hover {
        background-color: rgba(55, 65, 81, 0.75) !important; /* gray-700 with opacity */
      }

      /* Adjust border colors to match the new transparent theme */
      .border-gray-700 {
        border-color: rgba(243, 244, 246, 0.15) !important; /* brand-text with low opacity */
      }
      .border-gray-600 {
        border-color: rgba(243, 244, 246, 0.2) !important; /* brand-text with slightly higher opacity for inputs */
      }
      
      .border-b-2.border-brand-accent\\/30 {
          border-color: rgba(249, 115, 22, 0.5) !important; /* brand-accent with higher opacity */
      }
    </style>
    <!-- React and Babel for in-browser transpilation -->
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  </head>
  <body class="bg-brand-bg text-brand-text">
    <div id="root"></div>
    <script type="text/babel">
      // React Hooks
      const { useState, useEffect, useRef, useCallback, useMemo } = React;

      // --- HELPERS ---
      const formatPrice = (price) => {
        return new Intl.NumberFormat('es-AR', {
          style: 'currency',
          currency: 'ARS',
          minimumFractionDigits: 0,
          maximumFractionDigits: 0,
        }).format(price);
      };

      const SHIPPING_COST = 1000;
      const WHATSAPP_NUMBER = '5492477238364';

      // --- DATA ---
      const Category = {
        Todos: 'Todos',
        Pizzas: 'Pizzas',
        Hamburguesas: 'Hamburguesas',
        Sanguches: 'Sánguches',
        Bebidas: 'Bebidas',
      };

      const menuItems = [
        // Pizzas
        { id: 1, name: 'Pizza Mozzarella', category: Category.Pizzas, description: 'La clásica pizza con abundante mozzarella y salsa de tomate casera.', price: 100, ingredients: ['Masa de pizza', 'Salsa de tomate', 'Queso mozzarella', 'Aceitunas verdes', 'Orégano'], prepTime: '20-25 min', imageUrls: ['https://dieguitoushuaia.com/wp-content/uploads/2020/09/muzzarella.jpg']},
        { id: 2, name: 'Pizza Napolitana', category: Category.Pizzas, description: 'Mozzarella, rodajas de tomate fresco y un toque de ajo y albahaca.', price: 120, ingredients: ['Masa de pizza', 'Salsa de tomate', 'Queso mozzarella', 'Tomate fresco', 'Ajo', 'Albahaca', 'Aceitunas'], prepTime: '20-25 min', imageUrls: ['https://media.elgourmet.com/article/8metlvp345_portada-pizza.jpg']},
        { id: 3, name: 'Pizza Fugazzeta', category: Category.Pizzas, description: 'Una delicia para los amantes de la cebolla, con mozzarella y un toque de aceite de oliva.', price: 110, ingredients: ['Masa de pizza', 'Queso mozzarella', 'Cebolla blanca', 'Aceite de oliva', 'Orégano'], prepTime: '25-30 min', imageUrls: ['https://tofuu.getjusto.com/orioneat-local/resized2/8BmmxWrSsXHMr9Kpk-300-x.webp']},
        { id: 4, name: 'Pizza Calabresa', category: Category.Pizzas, description: 'Sabor intenso con longaniza calabresa, mozzarella y ají molido.', price: 130, ingredients: ['Masa de pizza', 'Salsa de tomate', 'Queso mozzarella', 'Longaniza calabresa', 'Ají molido', 'Aceitunas negras'], prepTime: '25-30 min', imageUrls: ['https://speedy.uenicdn.com/4c6d58bf-c626-4ade-85a5-5390e842a41a/c440_a/image/upload/v1612909110/business/f919def1-92cc-4aaa-906d-07447acb469b.jpg']},
        // Hamburguesas
        { id: 5, name: 'Hamburguesa Clásica', category: Category.Hamburguesas, description: 'Carne de primera, lechuga, tomate y nuestra salsa especial en pan brioche.', price: 100, ingredients: ['Carne de res', 'Pan brioche', 'Lechuga', 'Tomate', 'Cebolla', 'Salsa especial'], prepTime: '15-20 min', imageUrls: ['https://jetextramar.com/wp-content/uploads/2021/07/congelados-receta-hamburguesa-de-pollo-1024x768.jpg']},
        { id: 6, name: 'Hamburguesa Doble Cheddar', category: Category.Hamburguesas, description: 'Doble medallón de carne, doble porción de queso cheddar y panceta crujiente.', price: 100, ingredients: ['Doble carne de res', 'Pan brioche', 'Queso cheddar', 'Panceta', 'Pepinillos'], prepTime: '15-20 min', imageUrls: ['https://media-cdn.tripadvisor.com/media/photo-s/1c/c7/15/d1/holy-cheese-doble-hamburguesa.jpg']},
        { id: 7, name: 'Hamburguesa Criolla', category: Category.Hamburguesas, description: 'Con provoleta grillada, morrones asados y salsa criolla.', price: 100, ingredients: ['Carne de res', 'Pan rústico', 'Queso provoleta', 'Morrones asados', 'Huevo frito', 'Salsa criolla'], prepTime: '20-25 min', imageUrls: ['https://i.pinimg.com/1200x/03/82/15/0382153476c9ca4d2b7dfe4b69032bf7.jpg']},
        { id: 8, name: 'Hamburguesa Veggie', category: Category.Hamburguesas, description: 'Medallón de lentejas y champiñones, con rúcula, tomate y mayonesa de palta.', price: 100, ingredients: ['Medallón de lentejas', 'Pan integral', 'Rúcula', 'Tomate', 'Mayonesa de palta', 'Cebolla morada'], prepTime: '15-20 min', imageUrls: ['https://www.conasi.eu/blog/wp-content/uploads/2022/05/hamburguesa-vegana-1.jpg']},
        // Sánguches
        { id: 17, name: 'Sánguche de Milanesa Completo', category: Category.Sanguches, description: 'Milanesa de ternera, lechuga, tomate, jamón, queso y huevo frito en pan francés.', price: 100, ingredients: ['Pan francés', 'Milanesa de ternera', 'Lechuga', 'Tomate', 'Jamón', 'Queso', 'Huevo frito'], prepTime: '15-20 min', imageUrls: ['https://www.tafiviejo.gob.ar/fotos/cache/notas/2024/10/08/830x465_241008004008_43152.jpg']},
        { id: 18, name: 'Sánguche de Lomito', category: Category.Sanguches, description: 'Bife de lomo tierno, lechuga, tomate, jamón, queso, huevo y mayonesa casera.', price: 100, ingredients: ['Pan árabe', 'Bife de lomo', 'Lechuga', 'Tomate', 'Jamón', 'Queso', 'Huevo frito', 'Mayonesa'], prepTime: '15-20 min', imageUrls: ['https://www.clarin.com/img/2021/07/19/hgA-CEG32_1256x620__2.jpg']},
        { id: 19, name: 'Triple Tostado', category: Category.Sanguches, description: 'Un clásico sándwich de tres capas con jamón, queso, lechuga y tomate, perfectamente tostado.', price: 100, ingredients: ['Pan de miga triple', 'Jamón cocido', 'Queso de máquina', 'Lechuga', 'Tomate'], prepTime: '10-15 min', imageUrls: ['https://img-global.cpcdn.com/recipes/59296a703611b07c/300x426cq80/sandwich-triple-de-jamon-y-queso-foto-principal.webp']},
        // Bebidas
        { id: 25, name: 'Gaseosa Línea Coca-Cola', category: Category.Bebidas, description: 'Lata de 354ml. Elige entre Coca-Cola Original, Sin Azúcar o Light.', price: 100, ingredients: [], prepTime: 'N/A', imageUrls: ['https://latorrepizza.com.ar/wp-content/uploads/2023/03/B-GASEOSAS-min.jpg']},
        { id: 26, name: 'Agua Saborizada', category: Category.Bebidas, description: 'Botella de 500ml. Sabores: Manzana, Naranja, Pomelo.', price: 100, ingredients: [], prepTime: 'N/A', imageUrls: ['https://acdn.mitiendanube.com/stores/001/157/846/products/levitess-4e72e9073979c1786317062059644811-480-0.webp']},
        { id: 27, name: 'Cerveza Quilmes Clásica', category: Category.Bebidas, description: 'Lata de 473ml de la cerveza más popular de Argentina.', price: 100, ingredients: [], prepTime: 'N/A', imageUrls: ['https://shop.gustoargentino.com/cdn/shop/files/cerveza-quilmes.png?v=1741175524&width=640']},
        { id: 28, name: 'Vino Malbec (Copa)', category: Category.Bebidas, description: 'Una copa de nuestro Malbec de la casa, intenso y frutado.', price: 100, ingredients: [], prepTime: 'N/A', imageUrls: ['https://static.wixstatic.com/media/fe24ac_b2fe3b0b1fb84203891261b4fe4615b6~mv2.webp']},
      ];

      const itemsById = menuItems.reduce((acc, item) => {
        acc[item.id] = item;
        return acc;
      }, {});

      // --- ICONS ---
      const GridIcon = () => (<svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z" /></svg>);
      const InfoIcon = () => (<svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>);
      const CartIcon = ({count}) => (
        <div className="relative">
          <svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z" /></svg>
          {count > 0 && (
            <span className="absolute -top-2 -right-2 bg-brand-accent text-white text-xs rounded-full h-5 w-5 flex items-center justify-center">{count}</span>
          )}
        </div>
      );
      const WhatsAppIcon = () => <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" className="h-5 w-5 mr-2" fill="currentColor"><path d="M380.9 97.1C339 55.1 283.2 32 223.9 32c-122.4 0-222 99.6-222 222 0 39.1 10.2 77.3 29.6 111L0 480l117.7-30.9c32.4 17.7 68.9 27 106.1 27h.1c122.3 0 224.1-99.6 224.1-222 0-59.3-25.2-115-67.1-157zm-157 341.6c-33.8 0-65.7-8.9-94-25.7l-6.7-4-69.8 18.3L72 359.2l-4.4-7c-18.5-29.4-28.2-63.3-28.2-98.2 0-101.7 82.8-184.5 184.6-184.5 49.3 0 95.6 19.2 130.4 54.1 34.8 34.9 56.2 81.2 56.1 130.5 0 101.8-84.9 184.6-186.6 184.6zm101.2-138.2c-5.5-2.8-32.8-16.2-37.9-18-5.1-1.9-8.8-2.8-12.5 2.8-3.7 5.6-14.3 18-17.6 21.8-3.2 3.7-6.5 4.2-12 1.4-32.6-16.3-54-29.1-75.5-66-5.7-9.8 5.7-9.1 16.3-30.3 1.8-3.7.9-6.9-.5-9.7-1.4-2.8-12.5-30.1-17.1-41.2-4.5-10.8-9.1-9.3-12.5-9.5-3.2-.2-6.9-.2-10.6-.2-3.7 0-9.7 1.4-14.8 6.9-5.1 5.6-19.4 19-19.4 46.3 0 27.3 19.9 53.7 22.6 57.4 2.8 3.7 39.1 59.7 94.8 83.8 35.2 15.2 49 16.5 66.6 13.9 10.7-1.6 32.8-13.4 37.4-26.4 4.6-13 4.6-24.1 3.2-26.4-1.3-2.5-5-3.9-10.5-6.6z"/></svg>;
      const ChevronLeftIcon = () => <svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 19l-7-7 7-7" /></svg>;
      const PlusIcon = () => <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" className="w-5 h-5"><path d="M10.75 4.75a.75.75 0 00-1.5 0v4.5h-4.5a.75.75 0 000 1.5h4.5v4.5a.75.75 0 001.5 0v-4.5h4.5a.75.75 0 000-1.5h-4.5v-4.5z" /></svg>;
      const MinusIcon = () => <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" className="w-5 h-5"><path fillRule="evenodd" d="M4 10a.75.75 0 01.75-.75h10.5a.75.75 0 010 1.5H4.75A.75.75 0 014 10z" clipRule="evenodd" /></svg>;
      const TrashIcon = () => <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" className="w-5 h-5"><path fillRule="evenodd" d="M8.75 1A2.75 2.75 0 006 3.75v.443c-.795.077-1.58.22-2.365.468a.75.75 0 10.23 1.482l.149-.022.841 10.518A2.75 2.75 0 007.596 19h4.807a2.75 2.75 0 002.742-2.576l.84-10.518.149.022a.75.75 0 10.23-1.482A41.31 41.31 0 0014 4.193V3.75A2.75 2.75 0 0011.25 1h-2.5zM10 4c.84 0 1.673.025 2.5.075V3.75c0-.69-.56-1.25-1.25-1.25h-2.5c-.69 0-1.25.56-1.25 1.25v.325C8.327 4.025 9.16 4 10 4zM8.58 7.72a.75.75 0 00-1.5.06l.3 7.5a.75.75 0 101.5-.06l-.3-7.5zm4.34.06a.75.75 0 10-1.5-.06l-.3 7.5a.75.75 0 101.5.06l.3-7.5z" clipRule="evenodd" /></svg>;

      // --- COMPONENTS ---

      function Header({ setView }) {
        const logoUrl = "https://ia601008.us.archive.org/22/items/logo-blanco-y-naranja-02/logo%20blanco%20y%20naranja-02.svg";
        return (
          <header className="bg-brand-header border-b border-gray-700 sticky top-0 z-20">
            {/* Mobile Header */}
            <div className="max-w-md mx-auto flex items-center justify-center h-[4.5rem] lg:hidden">
              <img src={logoUrl} alt="La Escapadita Logo" className="h-14 w-auto"/>
            </div>
            {/* Desktop Header */}
            <div className="hidden lg:flex max-w-7xl mx-auto items-center justify-between h-[4.5rem] px-8">
              <img src={logoUrl} alt="La Escapadita Logo" className="h-14 w-auto cursor-pointer" onClick={() => setView('menu')} />
              <nav className="flex items-center space-x-6">
                  <button onClick={() => setView('menu')} className="text-brand-text hover:text-brand-accent transition-colors font-medium">Menú</button>
                  <button onClick={() => setView('about')} className="text-brand-text hover:text-brand-accent transition-colors font-medium">Nosotros</button>
              </nav>
            </div>
          </header>
        );
      }
      
      function CategoryNav({ selectedCategory, setSelectedCategory }) {
        const categories = [Category.Todos, Category.Pizzas, Category.Hamburguesas, Category.Sanguches, Category.Bebidas];
        const navRef = useRef(null);

        useEffect(() => {
            if (navRef.current) {
                const selectedButton = navRef.current.querySelector(`[data-category="${selectedCategory}"]`);
                if (selectedButton) {
                    selectedButton.scrollIntoView({ behavior: 'smooth', block: 'nearest', inline: 'center' });
                }
            }
        }, [selectedCategory]);

        return (
            <nav className="sticky top-[4.5rem] lg:top-0 bg-brand-header z-10 border-b border-t border-gray-700 lg:rounded-t-md">
                <div className="max-w-7xl mx-auto">
                  <div ref={navRef} className="flex space-x-1 overflow-x-auto no-scrollbar px-2">
                      {categories.map(category => (
                          <button
                              key={category}
                              data-category={category}
                              onClick={() => setSelectedCategory(category)}
                              className={`px-3 py-3 text-sm font-medium whitespace-nowrap transition-colors duration-200 border-b-2 ${
                                  selectedCategory === category 
                                  ? 'border-brand-accent text-brand-accent' 
                                  : 'border-transparent text-brand-text-light hover:text-brand-accent'
                              }`}
                          >
                              {category}
                          </button>
                      ))}
                  </div>
                </div>
            </nav>
        );
      }
      
      function MenuItemCard({ item, onSelect, onAdd, onAddFlavor, isMastroPizzaMode = false }) {
          const isPizza = item.category === Category.Pizzas;
          return (
            <div className={`bg-brand-card rounded-md border border-gray-700 overflow-hidden flex flex-col animate-fade-in-up transition-all ${isMastroPizzaMode && isPizza ? 'hover:border-brand-teal/50' : 'hover:border-brand-accent/50'}`}>
              <img src={item.imageUrls[0]} alt={item.name} className="w-full h-40 object-cover cursor-pointer" onClick={() => onSelect(item)} />
              <div className="p-4 flex flex-col flex-grow">
                <h3 className="text-lg font-extralight text-brand-text flex-grow">{item.name}</h3>
                <p className="text-brand-text-light text-sm mb-2 font-light">{item.description}</p>
                <div className="flex justify-between items-center mt-auto pt-2">
                  <span className="text-xl font-bold text-brand-accent">{formatPrice(item.price)}</span>
                  {isMastroPizzaMode ? (
                      <button 
                        onClick={() => onAddFlavor(item)} 
                        disabled={!isPizza}
                        className="bg-brand-teal text-white px-4 py-2 rounded-md font-semibold hover:bg-teal-600 transition-all transform hover:scale-105 disabled:bg-gray-500 disabled:cursor-not-allowed disabled:scale-100">
                        Añadir Sabor
                      </button>
                  ) : (
                      <button onClick={() => onAdd(item)} className="bg-brand-accent text-white px-4 py-2 rounded-md font-semibold hover:bg-orange-600 transition-all transform hover:scale-105">
                        Agregar
                      </button>
                  )}
                </div>
              </div>
            </div>
          );
      }

      function MastroPizzaBuilder({ state, onSelectPortions, onAddMastroPizzaToCart, onCancel }) {
          if (state.step === null) {
              return (
                  <div className="bg-brand-card p-6 rounded-md border border-gray-700 my-6 animate-fade-in-up">
                      <h2 className="text-2xl font-normal text-white font-display mb-2" style={{ fontWeight: 400 }}>Pide tu MastroPizza</h2>
                      <p className="text-brand-text-light mb-4 font-light">1- Elige las porciones para empezar a combinar sabores.</p>
                      <div className="grid grid-cols-1 sm:grid-cols-3 gap-4">
                          <button onClick={() => onSelectPortions(12)} className="bg-gray-700 text-brand-text p-3 rounded-md font-semibold hover:bg-gray-600 transition-colors">12 Porciones <span className="text-xs block font-light">(hasta 4 sabores)</span></button>
                          <button onClick={() => onSelectPortions(6)} className="bg-gray-700 text-brand-text p-3 rounded-md font-semibold hover:bg-gray-600 transition-colors">6 Porciones <span className="text-xs block font-light">(hasta 2 sabores)</span></button>
                          <button onClick={() => onSelectPortions(3)} className="bg-gray-700 text-brand-text p-3 rounded-md font-semibold hover:bg-gray-600 transition-colors">3 Porciones <span className="text-xs block font-light">(1 sabor)</span></button>
                      </div>
                  </div>
              );
          }
          
          const price = state.selectedFlavors.length > 0
              ? Math.max(...state.selectedFlavors.map(f => f.price))
              : 0;
          
          const isReadyToAdd = state.selectedFlavors.length > 0;

          return (
              <div className="bg-brand-card p-6 rounded-md border-2 border-brand-accent my-6 sticky top-[7.5rem] lg:top-[calc(4.5rem+4.5rem)] z-10 animate-fade-in shadow-lg shadow-orange-500/10">
                  <h2 className="text-2xl font-extralight text-brand-accent font-display mb-2">Armando tu MastroPizza</h2>
                  <p className="text-brand-text-light mb-4 font-light">
                      {`2- Elige los gustos (${state.selectedFlavors.length} de ${state.maxFlavors} seleccionados)`}
                  </p>
                  
                  {state.selectedFlavors.length > 0 && (
                      <div className="mb-4 space-y-2 bg-gray-900/50 p-3 rounded-md">
                          <p className="font-semibold text-brand-text">Sabores elegidos:</p>
                          <ul className="list-disc list-inside text-brand-text-light text-sm pl-2">
                              {state.selectedFlavors.map((flavor, index) => <li key={`${flavor.id}-${index}`}>{flavor.name}</li>)}
                          </ul>
                      </div>
                  )}
                  
                  {isReadyToAdd && (
                       <div className="flex justify-between items-center mb-4">
                        <span className="text-lg font-semibold text-brand-text">Precio Final:</span>
                        <span className="text-2xl font-bold text-brand-accent">{formatPrice(price)}</span>
                      </div>
                  )}

                  <div className="grid grid-cols-2 gap-4">
                       <button onClick={onCancel} className="bg-gray-700 text-brand-text py-3 rounded-md font-semibold hover:bg-gray-600 transition-colors">Cancelar</button>
                       <button 
                          onClick={() => onAddMastroPizzaToCart(price)} 
                          disabled={!isReadyToAdd} 
                          className="bg-brand-accent text-white py-3 rounded-md font-semibold hover:bg-orange-600 transition-transform transform hover:scale-105 disabled:bg-gray-500 disabled:cursor-not-allowed disabled:scale-100">
                          Agregar al Carrito
                      </button>
                  </div>
              </div>
          );
      }

      function AddToCartModal({ item, onClose, onConfirm }) {
          const [quantity, setQuantity] = useState(1);

          useEffect(() => {
              if (item) {
                  setQuantity(1);
              }
          }, [item]);

          if (!item) return null;

          const handleConfirm = () => {
            onConfirm(item.id, quantity);
            onClose();
          };

          return (
            <div className="fixed inset-0 bg-black bg-opacity-70 z-50 flex justify-center items-center animate-fade-in p-4" onClick={onClose}>
              <div className="bg-brand-card rounded-md shadow-xl w-full max-w-sm p-6 animate-fade-in-up border border-gray-600" onClick={e => e.stopPropagation()}>
                <h2 className="text-xl font-extralight text-brand-text mb-2 text-center">Vas a agregar al carrito</h2>
                <p className="text-2xl font-extralight font-display text-brand-accent text-center mb-4">{item.name}</p>

                <div className="flex items-center justify-center space-x-4 my-6">
                    <button onClick={() => setQuantity(q => Math.max(1, q - 1))} className="bg-gray-700 rounded-md p-3 text-brand-accent hover:bg-gray-600 transition-colors"><MinusIcon /></button>
                    <span className="text-2xl font-bold w-10 text-center tabular-nums">{quantity}</span>
                    <button onClick={() => setQuantity(q => q + 1)} className="bg-gray-700 rounded-md p-3 text-brand-accent hover:bg-gray-600 transition-colors"><PlusIcon /></button>
                </div>
                
                <div className="flex justify-between items-center mb-6">
                  <span className="text-lg font-semibold text-brand-text">Total:</span>
                  <span className="text-2xl font-bold text-brand-accent">{formatPrice(item.price * quantity)}</span>
                </div>

                <div className="grid grid-cols-2 gap-4">
                  <button 
                      onClick={onClose} 
                      className="w-full bg-gray-700 text-brand-text py-3 rounded-md font-semibold hover:bg-gray-600 transition-colors"
                      aria-label="Cancelar y volver al menú"
                  >
                    Atrás
                  </button>
                  <button 
                      onClick={handleConfirm} 
                      className="w-full bg-brand-accent text-white py-3 rounded-md font-semibold hover:bg-orange-600 transition-transform transform hover:scale-105"
                      aria-label={`Confirmar y agregar ${quantity} ${item.name} al carrito`}
                  >
                    Agregar
                  </button>
                </div>
              </div>
            </div>
          );
      }

      function ItemDetailModal({ item, onClose, onAddToCart }) {
        const [quantity, setQuantity] = useState(1);

        useEffect(() => {
            if (item) {
                setQuantity(1);
            }
        }, [item]);

        if (!item) return null;

        const handleAddToCart = () => {
          onAddToCart(item.id, quantity);
          onClose();
        };

        return (
          <div className="fixed inset-0 bg-black bg-opacity-70 z-50 flex justify-center items-center animate-fade-in" onClick={onClose}>
            <div className="bg-brand-card rounded-md shadow-xl w-11/12 max-w-lg max-h-[90vh] overflow-y-auto animate-fade-in-up relative border border-gray-600" onClick={e => e.stopPropagation()}>
              <button onClick={onClose} className="absolute top-4 left-4 z-10 bg-gray-900/80 backdrop-blur-sm rounded-md p-2 text-brand-text hover:bg-gray-800/90 transition-transform transform hover:scale-110" aria-label="Volver al menú">
                  <ChevronLeftIcon />
              </button>
              <img src={item.imageUrls[0]} alt={item.name} className="w-full h-64 object-cover" />
              <div className="p-6">
                <h2 className="text-3xl font-extralight font-display text-brand-text mb-2">{item.name}</h2>
                <p className="text-brand-text-light mb-4 font-light">{item.description}</p>
                {item.ingredients && item.ingredients.length > 0 && (
                  <div className="mb-4">
                    <h4 className="font-extralight text-brand-text">Ingredientes:</h4>
                    <p className="text-brand-text-light text-sm font-light">{item.ingredients.join(', ')}</p>
                  </div>
                )}
                <div className="flex items-center justify-between mb-6">
                    <span className="text-2xl font-bold text-brand-accent">{formatPrice(item.price * quantity)}</span>
                    <div className="flex items-center space-x-3 bg-gray-800 rounded-md p-1">
                        <button onClick={() => setQuantity(q => Math.max(1, q - 1))} className="bg-gray-700 hover:bg-gray-600 rounded-md p-2 text-brand-accent transition-colors"><MinusIcon /></button>
                        <span className="text-xl font-bold w-8 text-center">{quantity}</span>
                        <button onClick={() => setQuantity(q => q + 1)} className="bg-gray-700 hover:bg-gray-600 rounded-md p-2 text-brand-accent transition-colors"><PlusIcon /></button>
                    </div>
                </div>
                <button onClick={handleAddToCart} className="w-full bg-brand-accent text-white py-3 rounded-md font-semibold text-lg hover:bg-orange-600 transition-all transform hover:scale-105">
                  Agregar al Carrito
                </button>
              </div>
            </div>
          </div>
        );
      }

      function MenuPage({ onSelectItem, onAdd, selectedCategory, onAddFlavor, isMastroPizzaMode }) {
        const renderAllItems = () => {
            const categoryOrder = [Category.Pizzas, Category.Hamburguesas, Category.Sanguches, Category.Bebidas];
            
            return (
                <div className="p-4 space-y-8">
                    {categoryOrder.map(category => {
                        const itemsInCategory = menuItems.filter(item => item.category === category);
                        if (itemsInCategory.length === 0) return null;
                        
                        return (
                            <section key={category} aria-labelledby={`category-title-${category}`}>
                                <h2 id={`category-title-${category}`} className="font-display text-2xl font-extralight text-brand-accent pb-2 mb-6 border-b-2 border-brand-accent/30">{category}</h2>
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    {itemsInCategory.map(item => (
                                        <MenuItemCard key={item.id} item={item} onSelect={onSelectItem} onAdd={onAdd} onAddFlavor={onAddFlavor} isMastroPizzaMode={isMastroPizzaMode} />
                                    ))}
                                </div>
                            </section>
                        );
                    })}
                </div>
            );
        };

        const renderFilteredItems = () => {
            const filteredItems = menuItems.filter(item => item.category === selectedCategory);
            return (
                <div className="p-4 grid grid-cols-1 md:grid-cols-2 gap-6">
                    {filteredItems.map(item => (
                        <MenuItemCard key={item.id} item={item} onSelect={onSelectItem} onAdd={onAdd} onAddFlavor={onAddFlavor} isMastroPizzaMode={isMastroPizzaMode} />
                    ))}
                </div>
            );
        };

        return (
            <div>
                {selectedCategory === Category.Todos ? renderAllItems() : renderFilteredItems()}
            </div>
        );
      }
      
      function AboutPage({onBack}) {
        return (
           <div className="p-4 md:p-6 animate-fade-in-up">
                <button onClick={onBack} className="flex items-center text-brand-accent font-semibold mb-4 lg:hidden">
                    <ChevronLeftIcon /> Volver al Menú
                </button>
                <div className="bg-brand-card p-6 rounded-md border border-gray-700">
                    <h2 className="text-3xl font-extralight font-display text-brand-text mb-4">Sobre Nosotros</h2>
                    <p className="text-brand-text-light mb-4 font-light">
                        Bienvenidos a <strong>La Escapadita</strong>, tu rincón favorito en Pergamino para disfrutar de la mejor comida casera. Desde 2005, nos dedicamos a preparar pizzas, hamburguesas y empanadas con los ingredientes más frescos y todo el amor que nos caracteriza.
                    </p>
                    <p className="text-brand-text-light mb-4 font-light">
                        Nuestro secreto es simple: recetas familiares, productos de calidad y un equipo apasionado por la buena cocina. ¡Gracias por elegirnos!
                    </p>
                    <div className="border-t border-gray-700 my-4"></div>
                    <h3 className="text-xl font-extralight text-brand-text mb-2">Horarios</h3>
                    <p className="text-brand-text-light font-light">Martes a Domingos: 19:00hs a 23:30hs</p>
                </div>
           </div>
        );
      }
      
      function CheckoutView({ cart, updateCart, onBack, clearCart, isDesktop = false, customItems = {} }) {
        const [deliveryMethod, setDeliveryMethod] = useState('delivery'); // 'delivery' or 'pickup'
        const [address, setAddress] = useState('');
        const [customerName, setCustomerName] = useState('');
        const [phone, setPhone] = useState('');

        const allItems = useMemo(() => ({ ...itemsById, ...customItems }), [customItems]);

        const cartItems = useMemo(() => {
            return Object.entries(cart)
                .map(([id, quantity]) => {
                    const item = allItems[id];
                    // Ensure item exists before spreading, convert id to string for startsWith
                    return item ? { ...item, id: String(item.id), quantity } : null;
                })
                .filter(item => item && item.id);
        }, [cart, allItems]);

        const subtotal = useMemo(() => cartItems.reduce((sum, item) => sum + item.price * item.quantity, 0), [cartItems]);
        const total = useMemo(() => subtotal + (deliveryMethod === 'delivery' ? SHIPPING_COST : 0), [subtotal, deliveryMethod]);
        
        const handleConfirmOrder = () => {
          if (deliveryMethod === 'delivery' && !address.trim()) {
            alert('Por favor, ingresa tu dirección para el envío.');
            return;
          }
           if (!customerName.trim()) {
            alert('Por favor, ingresa tu nombre.');
            return;
          }
          if (!phone.trim()) {
            alert('Por favor, ingresa tu número de teléfono.');
            return;
          }

          const orderDetails = cartItems.map(item => {
            let detail = `- ${item.quantity} x ${item.name} (${formatPrice(item.price)} c/u) - Total: ${formatPrice(item.price * item.quantity)}`;
            if(item.description && item.id.startsWith('mastro-')) { // Add flavors for MastroPizza
              detail += `\n  (${item.description})`;
            }
            return detail;
          }).join('\n');
          
          let message = `*¡Nuevo Pedido desde la App!* 🍔🍕\n\n`;
          message += `*Cliente:* ${customerName}\n`;
          message += `*Teléfono:* ${phone}\n\n`;
          message += `*Resumen del Pedido:*\n${orderDetails}\n\n`;
          message += `*Subtotal:* ${formatPrice(subtotal)}\n`;

          if (deliveryMethod === 'delivery') {
            message += `*Método de Entrega:* Enviar a domicilio\n`;
            message += `*Dirección:* ${address}\n`;
            message += `*Costo de Envío:* ${formatPrice(SHIPPING_COST)}\n`;
          } else {
            message += `*Método de Entrega:* Retirar del local\n`;
          }
          
          message += `\n*TOTAL A PAGAR: ${formatPrice(total)}*`;

          const whatsappUrl = `https://wa.me/${WHATSAPP_NUMBER}?text=${encodeURIComponent(message)}`;
          window.open(whatsappUrl, '_blank');

          clearCart();
          setAddress('');
          setCustomerName('');
          setPhone('');
          setDeliveryMethod('delivery');
        };


        if (cartItems.length === 0) {
            return (
                <div className={`p-6 text-center animate-fade-in-up ${isDesktop ? 'bg-brand-card rounded-md border border-gray-700' : ''}`}>
                    <h2 className="text-2xl font-extralight text-brand-text mb-4 font-display">Tu carrito está vacío</h2>
                    <p className="text-brand-text-light mb-6 font-light">Agrega productos del menú para empezar.</p>
                    {!isDesktop && (
                        <button onClick={onBack} className="bg-brand-accent text-white px-6 py-3 rounded-md font-semibold hover:bg-orange-600 transition-transform transform hover:scale-105">
                            Ver Menú
                        </button>
                    )}
                </div>
            )
        }

        return (
          <div className={`p-4 animate-fade-in-up ${isDesktop ? '' : 'max-w-md mx-auto'}`}>
              {!isDesktop && (
                  <button onClick={onBack} className="flex items-center text-brand-accent font-semibold mb-4">
                      <ChevronLeftIcon /> Volver al Menú
                  </button>
              )}
              <h2 className="text-3xl font-extralight font-display text-brand-text mb-6">Finalizar Compra</h2>

              <div className="bg-brand-card p-4 rounded-md border border-gray-700 mb-6">
                <h3 className="font-extralight text-lg mb-4">Tu Pedido</h3>
                {cartItems.map(item => (
                    <div key={item.id} className="flex items-center justify-between py-3 border-b border-gray-700 last:border-b-0 gap-2">
                        <div className="flex-grow">
                            <p className="font-semibold">{item.name}</p>
                            {item.description && item.id.startsWith('mastro-') && <p className="text-sm text-brand-text-light font-light">{item.description}</p>}
                            <div className="flex items-center space-x-4 mt-2">
                                {/* Quantity controller */}
                                <div className="flex items-center space-x-2 rounded-md bg-gray-800 p-1">
                                    <button 
                                        onClick={() => updateCart(item.id, item.quantity - 1)} 
                                        className="bg-gray-700 hover:bg-gray-600 rounded-md p-1 text-brand-accent transition-colors"
                                        aria-label={`Disminuir cantidad de ${item.name}`}
                                    >
                                        <MinusIcon />
                                    </button>
                                    <span className="font-bold w-6 text-center" aria-live="polite">{item.quantity}</span>
                                    <button 
                                        onClick={() => updateCart(item.id, item.quantity + 1)} 
                                        className="bg-gray-700 hover:bg-gray-600 rounded-md p-1 text-brand-accent transition-colors"
                                        aria-label={`Aumentar cantidad de ${item.name}`}
                                    >
                                        <PlusIcon />
                                    </button>
                                </div>
                                <p className="text-sm text-brand-text-light">x {formatPrice(item.price)}</p>
                            </div>
                        </div>
                        <div className="flex items-center space-x-3">
                           <span className="font-bold text-brand-accent text-lg">{formatPrice(item.price * item.quantity)}</span>
                           <button 
                               onClick={() => updateCart(item.id, 0)} 
                               className="text-red-500 hover:text-red-700 p-2"
                               aria-label={`Eliminar ${item.name} del carrito`}
                           >
                             <TrashIcon />
                           </button>
                        </div>
                    </div>
                ))}
              </div>

              <div className="bg-brand-card p-4 rounded-md border border-gray-700 mb-6">
                  <h3 className="font-extralight text-lg mb-4">Tu Información</h3>
                  <input
                    type="text"
                    value={customerName}
                    onChange={(e) => setCustomerName(e.target.value)}
                    placeholder="Tu nombre"
                    className="w-full p-3 bg-gray-700 border border-gray-600 rounded-md mb-4 focus:ring-2 focus:ring-brand-accent focus:border-brand-accent focus:outline-none placeholder:text-gray-500"
                    aria-label="Nombre del cliente"
                  />
                  <input
                    type="tel"
                    value={phone}
                    onChange={(e) => setPhone(e.target.value)}
                    placeholder="Tu número de teléfono"
                    className="w-full p-3 bg-gray-700 border border-gray-600 rounded-md mb-4 focus:ring-2 focus:ring-brand-accent focus:border-brand-accent focus:outline-none placeholder:text-gray-500"
                    aria-label="Número de teléfono del cliente"
                  />
                  <h3 className="font-extralight text-lg mb-2">Método de Entrega</h3>
                  <div className="grid grid-cols-2 gap-4 mb-4">
                      <button onClick={() => setDeliveryMethod('delivery')} className={`p-3 rounded-md border-2 font-semibold transition-colors ${deliveryMethod === 'delivery' ? 'bg-brand-accent/20 border-brand-accent' : 'bg-gray-700 border-gray-600'}`}>
                          Enviar a domicilio
                      </button>
                      <button onClick={() => setDeliveryMethod('pickup')} className={`p-3 rounded-md border-2 font-semibold transition-colors ${deliveryMethod === 'pickup' ? 'bg-brand-accent/20 border-brand-accent' : 'bg-gray-700 border-gray-600'}`}>
                          Retirar del local
                      </button>
                  </div>
                  {deliveryMethod === 'delivery' && (
                      <input
                          type="text"
                          value={address}
                          onChange={(e) => setAddress(e.target.value)}
                          placeholder="Tu dirección completa"
                          className="w-full p-3 bg-gray-700 border border-gray-600 rounded-md focus:ring-2 focus:ring-brand-accent focus:border-brand-accent focus:outline-none placeholder:text-gray-500"
                          aria-label="Dirección de envío"
                      />
                  )}
              </div>

              <div className="bg-brand-card p-4 rounded-md border border-gray-700 mb-6">
                  <h3 className="font-extralight text-lg mb-4">Resumen de Costos</h3>
                  <div className="space-y-2 text-brand-text-light">
                      <div className="flex justify-between"><span>Subtotal</span><span className="font-semibold text-brand-text">{formatPrice(subtotal)}</span></div>
                      {deliveryMethod === 'delivery' && (
                        <div className="flex justify-between"><span>Envío</span><span className="font-semibold text-brand-text">{formatPrice(SHIPPING_COST)}</span></div>
                      )}
                      <div className="flex justify-between text-xl font-bold text-brand-text pt-2 border-t border-gray-700"><span>Total</span><span>{formatPrice(total)}</span></div>
                  </div>
              </div>

              <button onClick={handleConfirmOrder} className="w-full bg-brand-accent text-white py-4 rounded-md font-bold text-lg flex items-center justify-center hover:bg-orange-600 transition-all transform hover:scale-105 shadow-lg shadow-orange-500/30">
                <WhatsAppIcon /> Hacer pedido
              </button>
          </div>
        );
      }

      function BottomNav({ view, setView, cartCount }) {
        const navItems = [
          { id: 'menu', label: 'Menú', icon: <GridIcon /> },
          { id: 'about', label: 'Nosotros', icon: <InfoIcon /> },
          { id: 'checkout', label: 'Carrito', icon: <CartIcon count={cartCount} /> },
        ];

        return (
          <nav className="fixed bottom-0 left-0 right-0 bg-brand-card border-t border-gray-700 z-30 lg:hidden">
            <div className="flex justify-around max-w-md mx-auto">
              {navItems.map(({ id, label, icon }) => (
                <button
                  key={id}
                  onClick={() => setView(id)}
                  className={`flex flex-col items-center justify-center w-full pt-2 pb-1 transition-colors duration-200 ${
                    view === id ? 'text-brand-accent' : 'text-brand-text-light hover:text-brand-accent'
                  }`}
                  aria-label={label}
                >
                  {icon}
                  <span className="text-xs font-medium">{label}</span>
                </button>
              ))}
            </div>
          </nav>
        );
      }

      // --- APP ---
      function App() {
        const [view, setView] = useState('menu'); // 'menu', 'about', 'checkout'
        const [cart, setCart] = useState({}); // { itemId: quantity }
        const [customItems, setCustomItems] = useState({}); // For MastroPizzas
        const [selectedItem, setSelectedItem] = useState(null);
        const [itemToQuickAdd, setItemToQuickAdd] = useState(null);
        const [selectedCategory, setSelectedCategory] = useState(Category.Todos);
        const [mastroPizzaState, setMastroPizzaState] = useState({
          step: null, // null, 'flavors'
          portions: null,
          maxFlavors: 0,
          selectedFlavors: [],
        });
        const mastroPizzaRef = useRef(null);

        useEffect(() => {
          try {
            const savedCart = localStorage.getItem('laEscapaditaCart');
            const savedCustomItems = localStorage.getItem('laEscapaditaCustomItems');
            if (savedCart) setCart(JSON.parse(savedCart));
            if (savedCustomItems) setCustomItems(JSON.parse(savedCustomItems));
          } catch (error) {
            console.error("Failed to load data from localStorage:", error);
            setCart({});
            setCustomItems({});
          }
        }, []);

        useEffect(() => {
            try {
                localStorage.setItem('laEscapaditaCart', JSON.stringify(cart));
                localStorage.setItem('laEscapaditaCustomItems', JSON.stringify(customItems));
            } catch (error) {
                console.error("Failed to save data to localStorage:", error);
            }
        }, [cart, customItems]);
        
        const handleSetView = (newView) => {
          setView(newView);
          window.scrollTo({ top: 0, behavior: 'smooth' });
        };

        const updateCart = useCallback((itemId, quantity) => {
          setCart(prevCart => {
            const newCart = { ...prevCart };
            if (quantity <= 0) {
              delete newCart[itemId];
              // Also remove from custom items if it exists there
              if (String(itemId).startsWith('mastro-')) {
                  setCustomItems(prevCustom => {
                      const newCustom = {...prevCustom};
                      delete newCustom[itemId];
                      return newCustom;
                  });
              }
            } else {
              newCart[itemId] = quantity;
            }
            return newCart;
          });
        }, []);

        const addToCart = useCallback((itemId, quantity) => {
          setCart(prevCart => ({
            ...prevCart,
            [itemId]: (prevCart[itemId] || 0) + quantity,
          }));
        }, []);
        
        const clearCart = useCallback(() => {
          setCart({});
          setCustomItems({});
        }, []);

        const handleSelectPortions = (portions) => {
            let maxFlavors = 0;
            if (portions === 12) maxFlavors = 4;
            else if (portions === 6) maxFlavors = 2;
            else if (portions === 3) maxFlavors = 1;
            
            setMastroPizzaState({
                step: 'flavors',
                portions: portions,
                maxFlavors: maxFlavors,
                selectedFlavors: [],
            });
            setSelectedCategory(Category.Pizzas);
        };

        const handleAddFlavorToMastroPizza = (pizzaItem) => {
            setMastroPizzaState(prevState => {
                if (prevState.selectedFlavors.length >= prevState.maxFlavors) {
                    return prevState;
                }

                const newFlavors = [...prevState.selectedFlavors, pizzaItem];
                mastroPizzaRef.current?.scrollIntoView({ behavior: 'smooth', block: 'center' });

                return {
                    ...prevState,
                    selectedFlavors: newFlavors,
                };
            });
        };

        const handleCancelMastroPizza = () => {
            setMastroPizzaState({
                step: null, portions: null, maxFlavors: 0, selectedFlavors: [],
            });
        };

        const handleAddMastroPizzaToCart = (price) => {
            const { portions, selectedFlavors } = mastroPizzaState;
            if (selectedFlavors.length === 0) return;

            const customId = `mastro-${Date.now()}`;
            const mastroPizzaItem = {
                id: customId,
                name: `MastroPizza ${portions} Porciones`,
                description: selectedFlavors.map(f => f.name).join(' + '),
                price: price,
                category: Category.Pizzas,
            };
            
            setCustomItems(prev => ({...prev, [mastroPizzaItem.id]: mastroPizzaItem }));
            addToCart(mastroPizzaItem.id, 1);
            handleCancelMastroPizza();
        };


        const cartCount = useMemo(() => Object.values(cart).reduce((sum, q) => sum + q, 0), [cart]);

        return (
          <div className="min-h-screen">
            <Header setView={handleSetView} />
            
            <div className="max-w-7xl mx-auto lg:grid lg:grid-cols-12 lg:gap-x-8 lg:px-4">
              <div className="lg:col-span-7 xl:col-span-8">
                {/* Main content: Menu or About page */}
                <div className={`${view === 'checkout' ? 'hidden' : 'block'} lg:block`}>
                   {view !== 'about' && <CategoryNav selectedCategory={selectedCategory} setSelectedCategory={setSelectedCategory} />}
                   
                   {view === 'menu' && (selectedCategory === Category.Todos || selectedCategory === Category.Pizzas) && (
                     <div ref={mastroPizzaRef} className="px-4 md:px-0">
                         <MastroPizzaBuilder 
                             state={mastroPizzaState}
                             onSelectPortions={handleSelectPortions}
                             onAddMastroPizzaToCart={handleAddMastroPizzaToCart}
                             onCancel={handleCancelMastroPizza}
                         />
                     </div>
                   )}

                   <main className="pb-24 lg:pb-12">
                     {view === 'about' ? (
                       <AboutPage onBack={() => handleSetView('menu')} />
                     ) : (
                       <MenuPage 
                         onSelectItem={setSelectedItem} 
                         onAdd={setItemToQuickAdd}
                         selectedCategory={selectedCategory}
                         onAddFlavor={handleAddFlavorToMastroPizza}
                         isMastroPizzaMode={mastroPizzaState.step === 'flavors'}
                       />
                     )}
                   </main>
                </div>
                
                {/* Mobile-only Fullscreen Checkout */}
                {view === 'checkout' && (
                  <div className="lg:hidden">
                    <CheckoutView
                      cart={cart}
                      updateCart={updateCart}
                      onBack={() => handleSetView('menu')}
                      clearCart={clearCart}
                      isDesktop={false}
                      customItems={customItems}
                    />
                  </div>
                )}
              </div>
              
              {/* Desktop Sidebar */}
              <aside className="hidden lg:block lg:col-span-5 xl:col-span-4 py-6 lg:pr-4">
                <div className="sticky top-[calc(4.5rem+1.5rem)]">
                  <CheckoutView
                    cart={cart}
                    updateCart={updateCart}
                    onBack={() => {}} // No-op for desktop
                    clearCart={clearCart}
                    isDesktop={true}
                    customItems={customItems}
                  />
                </div>
              </aside>
            </div>

            {/* Modals are global */}
            <ItemDetailModal item={selectedItem} onClose={() => setSelectedItem(null)} onAddToCart={addToCart} />
            <AddToCartModal item={itemToQuickAdd} onClose={() => setItemToQuickAdd(null)} onConfirm={addToCart} />
            
            {/* Mobile-only Bottom Nav */}
            <BottomNav view={view} setView={handleSetView} cartCount={cartCount} />
          </div>
        );
      }

      // --- RENDER ---
      const root = ReactDOM.createRoot(document.getElementById('root'));
      root.render(<App />);
    </script>
  </body>
</html>
